# ポジション仕様

## 概要

語録に自動でポジション（野手ポジション）を割り当て、打線に表示する仕様です。

## 仕様詳細

### 1. 新規生成時のポジション自動割り当て

- **自動割り当て**: 新規生成された語録には、自動で野手ポジションが割り当てられます
- **重複回避**: 既存の語録で使用済みのポジションは避けて、未使用のポジションを優先的に割り当てます
- **データベース保存**: 割り当てられたポジションはデータベース（Supabase/JSON）に保存されます（内部データとして）
- **割り当てロジック**: 
  - 既存の語録から使用済みの野手ポジションを取得
  - 未使用のポジションがあれば、その中からIDベースのシードでランダムに選択
  - すべて使用済みの場合は、ランダムに割り当て（重複を許容）

### 2. 打線表示時のロジック

- **スコア順ソート**: 累計スコア（いいね × リツイート × 引用リツイート）で降順にソート
- **野手ポジションのみ**: 投手ポジション（先発、中継ぎ、抑え）は除外
- **重複防止**: **同じポジションが複数ある場合は、スコア順で1つだけ選ぶ**
  - 例：レフトが2つある場合、スコアが高い方のみが選ばれる
- **上位9位**: 最大9位までを選定
- **ランダム化**: 選定後、日付ベースのシードでランダムに並び替え（1日1回の集計）

### 3. 野手ポジション一覧

使用可能なポジション：
- `右` (右翼手)
- `左` (左翼手)
- `中` (中堅手)
- `三` (三塁手)
- `一` (一塁手)
- `二` (二塁手)
- `遊` (遊撃手)
- `捕` (捕手)
- `DH` (指名打者)
- `指` (指定打者)

合計10ポジション（打線は最大9位まで）

## 実装詳細

### ポジション割り当て関数 (`lib/quotes.ts`)

```typescript
async function assignPosition(existingQuotes: Quote[], newId: number): Promise<string>
```

- 既存の語録から使用済みポジションを取得
- 未使用ポジションからランダムに選択（IDベースのシード）
- すべて使用済みの場合はランダムに割り当て

### 打線選定ロジック (`app/page.tsx`)

1. **スコア順ソート**: `calculateScore(b) - calculateScore(a)`
2. **ポジションごとに1つだけ選ぶ**: `Map<string, Quote>`でポジションをキーに管理
3. **未割り当て語録への割り当て**: positionがない語録に未使用ポジションを割り当て
4. **ランダム化**: 日付ベースのシードでシャッフル

## 注意事項

- ポジションは内部データとして保存されます（ユーザーには直接表示されません）
- 打線では、同じポジションは必ず1つだけ表示されます
- ポジションが設定されていない古いデータがある場合、打線表示時に自動で割り当てられます

