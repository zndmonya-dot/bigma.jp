# リリースガイド - Bigma

本番環境へのリリース手順をステップバイステップで説明します。

## 📋 事前準備チェックリスト

### 1. コード品質確認

#### ビルド確認
```bash
npm run build
```
- [ ] ビルドが成功すること
- [ ] TypeScriptエラーがないこと
- [ ] 警告が適切に処理されていること

#### ローカル動作確認
```bash
npm run dev
```
- [ ] 開発サーバーが正常に起動すること
- [ ] メインページが正常に表示されること
- [ ] 生成機能が動作すること

### 2. 環境変数の準備

#### 必須環境変数
- [ ] `OPENAI_API_KEY`: OpenAI APIキーを取得
  - 取得先: https://platform.openai.com/api-keys
  - **重要**: 本番環境用のAPIキーを使用すること
  - クレジット残高が十分であることを確認
  - 支払い方法が設定されていることを確認

#### 任意環境変数
- [ ] `NEXT_PUBLIC_GOOGLE_ADSENSE_CLIENT_ID`: Google AdSenseクライアントID
  - 広告を表示する場合のみ必要
  - 例: `ca-pub-XXXXXXXXXXXXXXXX`
  - AdSenseアカウントが承認されていることを確認

### 3. データ確認

- [ ] `data/base_quotes.json` が存在すること
- [ ] `data/quotes.json` が存在すること（空でも可）
- [ ] データの形式が正しいこと

### 4. セキュリティ確認

- [ ] `.env.local` が `.gitignore` に含まれていること
- [ ] 環境変数がGitにコミットされていないこと
- [ ] 入力サニタイズ・バリデーションが実装されていること
- [ ] XSS対策が実装されていること

### 5. PWA確認

- [ ] `public/manifest.json` が存在すること
- [ ] `public/icon-192.svg` が存在すること
- [ ] `public/icon-512.svg` が存在すること

---

## 🚀 デプロイ手順（Vercel推奨）

### Step 1: GitHubリポジトリの準備

1. **Gitリポジトリの状態確認**
   ```bash
   git status
   ```

2. **変更をコミット**
   ```bash
   git add .
   git commit -m "リリース準備完了"
   ```

3. **GitHubにプッシュ**
   ```bash
   git push origin main
   ```
   - リモートリポジトリが存在しない場合は作成:
     ```bash
     git remote add origin https://github.com/yourusername/yourrepo.git
     git push -u origin main
     ```

### Step 2: Vercelプロジェクトの作成

1. **Vercelにログイン**
   - https://vercel.com にアクセス
   - GitHubアカウントでログイン（推奨）

2. **新規プロジェクト作成**
   - 「Add New Project」をクリック
   - GitHubリポジトリをインポート
   - プロジェクト名を設定（例: `bigma`）

3. **ビルド設定確認**
   - Framework Preset: **Next.js** が自動選択されていることを確認
   - Build Command: `next build`（デフォルト）
   - Output Directory: `.next`（デフォルト）
   - Install Command: `npm install`（デフォルト）

### Step 3: 環境変数の設定

1. **プロジェクト設定画面を開く**
   - Vercelダッシュボード → プロジェクト → Settings → Environment Variables

2. **必須環境変数を追加**
   - **Name**: `OPENAI_API_KEY`
   - **Value**: 本番用のOpenAI APIキー（`sk-...`）
   - **Environment**: `Production`, `Preview`, `Development` すべてにチェック
   - 「Add」をクリック

3. **任意環境変数を追加**（広告を表示する場合のみ）
   - **Name**: `NEXT_PUBLIC_GOOGLE_ADSENSE_CLIENT_ID`
   - **Value**: Google AdSenseクライアントID（`ca-pub-...`）
   - **Environment**: `Production`, `Preview`, `Development` すべてにチェック
   - 「Add」をクリック

### Step 4: 初回デプロイ

1. **デプロイ実行**
   - 「Deploy」ボタンをクリック
   - ビルドログを確認

2. **ビルド成功の確認**
   - [ ] ビルドが成功すること
   - [ ] エラーや警告がないこと
   - [ ] デプロイが完了すること

3. **本番URL確認**
   - デプロイ完了後、本番URLが表示されます
   - 例: `https://bigma.vercel.app`

### Step 5: 本番環境での動作確認

#### 機能テスト

1. **メインページ**
   - [ ] ページが正常に表示されること
   - [ ] ヘッダーが正常に表示されること
   - [ ] 生成フォームが表示されること

2. **生成機能**
   - [ ] 入力フィールドに入力できること
   - [ ] 生成ボタンをクリックできること
   - [ ] 生成が正常に動作すること
   - [ ] 結果が表示されること
   - [ ] 自動保存が動作すること

3. **語録一覧**
   - [ ] 語録一覧が表示されること
   - [ ] タブ（新着・月間・累計）が動作すること
   - [ ] いいね機能が動作すること
   - [ ] リツイート・引用リツイートボタンが表示されること

4. **打線ランキング**
   - [ ] 打線が表示されること
   - [ ] 日替わりでランダム表示されること
   - [ ] いいね・リツイートボタンが動作すること

5. **X投稿機能**
   - [ ] 「Xで投稿」ボタンが表示されること
   - [ ] クリックでX投稿画面が開くこと
   - [ ] 投稿内容が正しいこと

6. **レスポンシブデザイン**
   - [ ] PC表示が正常であること
   - [ ] スマホ表示が正常であること
   - [ ] タブレット表示が正常であること

7. **ダークモード**
   - [ ] システム設定に応じて切り替わること
   - [ ] ライトモード・ダークモードともに正常に表示されること

8. **PWA**
   - [ ] モバイルでPWAとしてインストール可能であること
   - [ ] アイコンが表示されること

#### パフォーマンス確認

- [ ] 初回ロード時間が適切であること（3秒以内推奨）
- [ ] API応答時間が適切であること（5秒以内推奨）
- [ ] ページがスムーズに動作すること

#### エラー確認

- [ ] ブラウザコンソールにエラーがないこと
- [ ] ネットワークタブでエラーがないこと

---

## 🔧 トラブルシューティング

### ビルドエラー

**エラー**: TypeScriptエラー
```bash
# ローカルでビルドを実行して確認
npm run build
```

**エラー**: 依存関係エラー
```bash
# 依存関係を再インストール
rm -rf node_modules package-lock.json
npm install
```

**エラー**: 環境変数が見つからない
- Vercelの環境変数設定を確認
- 環境変数名が正しいか確認
- デプロイ後に反映されることを確認（キャッシュクリアが必要な場合あり）

### 実行時エラー

**エラー**: OpenAI APIエラー
- APIキーが正しく設定されているか確認
- OpenAIアカウントのクレジット残高を確認
- 支払い方法が設定されているか確認
- `OPENAI_SETUP.md` を参照

**エラー**: 生成が動作しない
- レート制限に達していないか確認（本番環境では1日3回まで）
- APIキーの権限を確認
- ブラウザコンソールでエラーメッセージを確認

### 広告が表示されない

- AdSenseアカウントが承認されているか確認
- クライアントIDが正しく設定されているか確認
- 自動広告が有効になっているか確認
- デプロイ後に反映まで数時間かかる場合があります

---

## 📊 リリース後の確認事項

### 1. モニタリング設定

- [ ] Vercelのダッシュボードでアクセス状況を確認
- [ ] OpenAIの使用量ダッシュボードを確認
- [ ] エラーログを定期的に確認

### 2. コスト管理

- [ ] OpenAI APIの使用量監視を設定
- [ ] 予算アラートを設定（推奨）
- [ ] レート制限が適切に機能しているか確認

### 3. パフォーマンス最適化

- [ ] 初回ロード時間を監視
- [ ] API応答時間を監視
- [ ] 必要に応じて最適化を実施

### 4. ユーザーフィードバック

- [ ] エラーレポートを確認
- [ ] ユーザーフィードバックを収集
- [ ] 改善点を記録

---

## 🎉 リリース完了

すべての手順が完了したら、以下を確認してください：

- [ ] 本番環境で正常に動作していること
- [ ] すべての機能が正常に動作していること
- [ ] エラーが発生していないこと
- [ ] パフォーマンスが適切であること

**おめでとうございます！Bigmaが本番環境にリリースされました！** 🚀

---

## 📝 次のステップ

リリース後は、以下の点を継続的に監視・改善してください：

1. **ユーザーアクセスの監視**
2. **エラーログの確認**
3. **パフォーマンスの最適化**
4. **新機能の追加**（必要に応じて）
5. **データ収集の継続**（Few-shot学習の精度向上のため）

---

## 📚 参考ドキュメント

- [RELEASE_CHECKLIST.md](./RELEASE_CHECKLIST.md) - 詳細なチェックリスト
- [OPENAI_SETUP.md](./OPENAI_SETUP.md) - OpenAI API設定ガイド
- [README.md](./README.md) - プロジェクトの概要
- [企画書.md](./企画書.md) - プロジェクト企画書
- [TECH_DOCS.md](./TECH_DOCS.md) - 技術ドキュメント

