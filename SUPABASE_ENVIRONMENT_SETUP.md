# Supabase 開発/本番環境分離ガイド

## 概要

開発環境と本番環境でSupabaseプロジェクトを分離することで、安全にテストと開発を行えます。

## メリット

### ✅ データの分離
- 開発環境でテストデータを自由に追加・削除できる
- 本番環境のデータを汚染しない
- ユーザーデータを誤って削除するリスクを回避

### ✅ スキーマ変更の安全なテスト
- マイグレーションを開発環境で先にテスト
- 本番環境に影響を与えずに検証可能

### ✅ パフォーマンステスト
- 開発環境で負荷テストを実行しても本番に影響なし

## デメリット

### ⚠️ コスト
- Supabase Freeプランなら2プロジェクトまで無料
- 2つを超える場合は有料プランが必要

### ⚠️ 複雑さ
- 環境変数の管理が必要
- デプロイ時の環境変数設定を忘れないようにする必要がある

## セットアップ手順

### 1. Supabaseプロジェクトの構成

- **本番環境**: 既存の`bigma`プロジェクトを使用（既に設定済み）
- **開発環境**: 新規で`bigma-dev`プロジェクトを作成

#### 開発環境プロジェクト作成
1. Supabaseダッシュボードにアクセス
2. 「New Project」をクリック
3. プロジェクト名: `bigma-dev`
4. リージョン: 日本（Tokyo）など
5. データベースパスワードを設定
6. 作成完了後、Project URLとanon keyを取得

### 2. スキーマをコピー

開発環境（`bigma-dev`）にスキーマを適用：

1. `supabase-schema.sql`（quotesテーブル用）
2. `supabase-base-quotes-schema.sql`（base_quotesテーブル用）

※ 本番環境（`bigma`）は既にスキーマが適用済み

### 3. 環境変数の設定

#### ローカル開発環境（.env.local）

```env
# 開発環境（bigma-dev）
SUPABASE_URL=https://bigma-dev-project-id.supabase.co
SUPABASE_ANON_KEY=bigma-dev-anon-key
```

#### Vercel環境変数

**開発/プレビュー環境**:
- `SUPABASE_URL`: `bigma-dev`のProject URL
- `SUPABASE_ANON_KEY`: `bigma-dev`のanon key

**本番環境**:
- `SUPABASE_URL`: 既存の`bigma`プロジェクトのProject URL（現在の設定をそのまま使用）
- `SUPABASE_ANON_KEY`: 既存の`bigma`プロジェクトのanon key（現在の設定をそのまま使用）

Vercelでは環境ごとに異なる環境変数を設定できます。

### 4. コードの変更（必要に応じて）

現在のコードは環境変数から自動的に読み込むので、追加の変更は基本的に不要です。

```typescript
// lib/supabase.ts で既に実装済み
const supabaseUrl = process.env.SUPABASE_URL;
const supabaseAnonKey = process.env.SUPABASE_ANON_KEY;
```

## 環境の使い分け

### 開発環境
- ✅ テストデータの追加・削除
- ✅ スキーマ変更のテスト
- ✅ 機能開発・デバッグ
- ✅ パフォーマンステスト

### 本番環境
- ✅ 実際のユーザーデータ
- ✅ 本番運用
- ✅ 安定性重視
- ⚠️ 変更は慎重に

## データ同期（必要に応じて）

開発環境から本番環境にデータを移行する場合：

1. **base_quotesテーブル**:
   - 開発環境で品質の高いデータを選別
   - 本番環境に手動で追加（SQLでインポート）

2. **quotesテーブル**:
   - 本番環境のデータは本番環境のみ
   - 開発環境にはサンプルデータのみ

## 推奨事項

### 必須ではないが推奨

- ✅ 開発環境と本番環境を分離（データ保護のため）
- ✅ スキーマ変更は開発環境で先にテスト
- ✅ 本番環境のデータはバックアップを定期的に取得

### 小規模プロジェクトの場合

- 無料プランで1プロジェクトのみ使用することも可能
- 本番環境のみで運用し、テストは慎重に行う

## コスト

- **Freeプラン**: 2プロジェクトまで無料
- **Proプラン**: より多くのプロジェクトが可能

## 確認方法

環境変数が正しく設定されているか確認：

```bash
# ローカル開発環境
npm run dev
# .env.localの環境変数が読み込まれる

# Vercelでは環境変数タブで確認
```

## 注意事項

- ⚠️ 本番環境の環境変数は絶対にGitHubにコミットしない
- ⚠️ 環境変数の設定を忘れるとSupabaseに接続できない
- ⚠️ デプロイ時に環境ごとの設定を確認する

